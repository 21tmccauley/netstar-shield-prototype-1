function s(e,a){let t="safe";a>=75?t="safe":a>=60?t="warning":t="danger",chrome.action.setIcon({tabId:e,path:{16:`src/icons/icon-${t}-16.png`,48:`src/icons/icon-${t}-48.png`,128:`src/icons/icon-${t}-128.png`}}),console.log(`Icon updated to ${t} (score: ${a})`)}chrome.runtime.onInstalled.addListener(()=>{console.log("NetSTAR extension installed"),chrome.action.setIcon({path:{16:"src/icons/icon-safe-16.png",48:"src/icons/icon-safe-48.png",128:"src/icons/icon-safe-128.png"}}),chrome.storage.local.set({recentScans:[{url:"github.com",safe:!0,timestamp:Date.now()},{url:"google.com",safe:!0,timestamp:Date.now()},{url:"amazon.com",safe:!0,timestamp:Date.now()}],settings:{autoScan:!0,notifications:!0}})});chrome.tabs.onUpdated.addListener((e,a,t)=>{if(a.status==="complete"&&t.url){console.log("Tab updated:",t.url);const o=c(t.url);s(e,o.safetyScore),chrome.storage.local.set({[`scan_${e}`]:o})}});chrome.tabs.onActivated.addListener(async e=>{const a=await chrome.tabs.get(e.tabId);if(a.url){const t=await chrome.storage.local.get(`scan_${e.tabId}`);if(t[`scan_${e.tabId}`])s(e.tabId,t[`scan_${e.tabId}`].safetyScore);else{const o=c(a.url);s(e.tabId,o.safetyScore),chrome.storage.local.set({[`scan_${e.tabId}`]:o})}}});chrome.runtime.onMessage.addListener((e,a,t)=>{if(e.action==="scanUrl"){const o=c(e.url);chrome.tabs.query({active:!0,currentWindow:!0},n=>{n[0]&&(s(n[0].id,o.safetyScore),chrome.storage.local.set({[`scan_${n[0].id}`]:o}))}),t(o)}return e.action==="getCurrentTab"&&chrome.tabs.query({active:!0,currentWindow:!0},async o=>{if(o[0]){const n=await chrome.storage.local.get(`scan_${o[0].id}`);t({url:o[0].url,title:o[0].title,securityData:n[`scan_${o[0].id}`]||null})}}),!0});function c(e){let a;return a=60,console.log("ðŸ”§ TEST MODE: Using fixed score of 60"),{safetyScore:a,indicators:[{id:"cert",name:"Certificate Health",score:95,status:"excellent"},{id:"connection",name:"Connection Security",score:100,status:"excellent"},{id:"domain",name:"Domain Reputation",score:78,status:"good"},{id:"credentials",name:"Credential Safety",score:85,status:"good"},{id:"ip",name:"IP Reputation",score:92,status:"excellent"},{id:"dns",name:"DNS Record Health",score:88,status:"good"},{id:"whois",name:"WHOIS Pattern",score:71,status:"moderate"}],timestamp:Date.now()}}
